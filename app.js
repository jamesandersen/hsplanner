webpackJsonp([2],[function(t,e,n){n(8),n(9),t.exports=n(11)},,,,,,,,function(t,e,n){t.exports=n.p+"index.html"},function(){"use strict";!function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,a=arguments[1],i=0;r>i;i++)if(e=n[i],t.call(a,e,i,n))return e;return void 0})}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,a=arguments[1],i=0;r>i;i++)if(e=n[i],t.call(a,e,i,n))return i;return-1})}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}})}()},,function(t,e,n){(function(t){n(17),n(18),n(19);!function(){"use strict";var e=t.module("hsp",["ngRoute","ngAnimate","ngMaterial","ngMdIcons","hsp.common","hsp.auth","hsp.schedule"]);t.module("hsp.auth").constant("CLIENT_ID","<!-- @secret client_id -->"),t.module("hsp.common").constant("BASE_URL","https://home-school.azurewebsites.net"),e.config(["$locationProvider","$routeProvider",function(t,e){t.html5Mode(!0),e.when("/",{templateUrl:"components/schedule/schedule.html",controller:"ScheduleCtrl as schedule",resolve:{token:["hsAuthService",function(t){return t.afterLogin()}]}}).when("/profile",{templateUrl:"components/auth/profile.html",controller:"ProfileCtrl"}).when("/event-detail",{templateUrl:"components/schedule/event-detail.html",controller:"EventDetailCtrl"}).when("/login",{templateUrl:"components/auth/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]),e.config(["$httpProvider",function(t){t.interceptors.push("calendarHttpInterceptor")}]),e.config(["$mdThemingProvider",function(t){t.theme("default").primaryPalette("pink").accentPalette("orange")}]),e.run(["hsAuthService","$location","$log",function(t,e,n){t.loadGoogleAPI().then(function(){t.afterLogin().then(function(){},function(t){n.warn("not signed in at startup: "+t),e.url("/login?dst="+encodeURIComponent(e.url()))})},function(t){n.warn("google api not loaded: "+t)})}])}()}).call(e,n(14))},,,,,,function(t,e,n){(function(t){"use strict";t.module("hsp.common",[]),t.module("hsp.common").constant("MathUtil",n(31)),t.module("hsp.common").constant("Util",n(32))}).call(e,n(14))},function(t,e,n){(function(t){"use strict";n(29);t.module("hsp.auth",["ngResource"]);t.module("hsp.auth").constant("authEvents",{AUTHENTICATION_CHANGE:"AUTHENTICATION_CHANGE"}),t.module("hsp.auth").factory("hsAuthService",n(33)),t.module("hsp.auth").controller("HeaderCtrl",n(34)),t.module("hsp.auth").controller("LoginCtrl",n(35)),t.module("hsp.auth").controller("ProfileCtrl",n(36)),t.module("hsp.auth").factory("Profile",n(37))}).call(e,n(14))},function(t,e,n){(function(t){"use strict";var e=function(t){return t&&t.__esModule?t:{"default":t}};n(30);var r=e(n(38));t.module("hsp.schedule",["hsp.auth"]),t.module("hsp.schedule").controller("EventDetailCtrl",n(39)),t.module("hsp.schedule").constant("CALENDAR_BASE_URI",r.BASE_URI),t.module("hsp.schedule").factory("hsCalendarService",r.hsCalendarService),t.module("hsp.schedule").factory("calendarHttpInterceptor",r.calendarHttpInterceptor),t.module("hsp.schedule").filter("hasEvents",n(40)),t.module("hsp.schedule").controller("ScheduleCtrl",n(41)),t.module("hsp.schedule").factory("ScheduleModel",n(42))}).call(e,n(14))},,,,,,,,,,function(t,e,n){function r(t){return n(a(t))}function a(t){return i[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var i={"./login.html":46,"./profile.html":47};r.keys=function(){return Object.keys(i)},r.resolve=a,t.exports=r,r.id=29},function(t,e,n){function r(t){return n(a(t))}function a(t){return i[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var i={"./event-detail.html":48,"./schedule.html":49};r.keys=function(){return Object.keys(i)},r.resolve=a,t.exports=r,r.id=30},function(t){"use strict";t.exports={ceiling:function(t,e){return Math.ceil(t/e)*e},floor:function(t,e){return Math.floor(t/e)*e}}},function(t,e,n){(function(e){"use strict";t.exports=function(){return{safeRead:function(t,n){var r=n.split("."),a=t,i=0;for(i=0;i<r.length;i++){if(e.isUndefined(a)||null===a||!a.hasOwnProperty(r[i]))return void 0;a=a[r[i]]}return a},safeSet:function(t,n,r){if(e.isObject(t)){var a=n.split("."),i=t,o=0;for(o=0;o<a.length;o++){if(!(o<a.length-1))return void(i[a[o]]=r);if(e.isUndefined(i[a[o]]))i[a[o]]={};else if(!e.isObject(i[a[o]]))throw"Cannot set on non-object path segment: "+a[o];i=i[a[o]]}}}}}()}).call(e,n(14))},function(t){"use strict";t.exports=function(){return["$window","$document","$location","$rootScope","$q","$log","$http","CLIENT_ID","authEvents","Profile",function(t,e,n,r,a,i,o,c,s,l){function d(){i.info("google plus API loaded"),E=!0,delete t.onAPILoad,_.resolve(!0)}function u(t){var e=!1;t&&!b?(b=!0,e=!0):!t&&b&&(b=!1,e=!0),e&&r.$broadcast(s.AUTHENTICATION_CHANGE,b)}function h(t){i.debug("google plus API auth callback: "+JSON.stringify(t)),t.status.signed_in?(M=t.access_token,y=new Date,y.setMilliseconds(y.getMilliseconds()+t.expires_in),i.info("successful login; access token expires at "+y.toLocaleTimeString()),o.get("https://www.googleapis.com/plus/v1/people/me",{headers:{Authorization:"Bearer "+M}}).success(function(t){z=l.get({userId:t.id},function(e){z=e,$=t,u(!0),w&&(w.resolve(M),w=null)})}).error(function(){i.error("Error getting profile information")}),C&&(C.resolve(M),C=null)):(i.error("authentication error: "+t.error),u(!1),w&&(w.reject(t.error),w=null),C&&(C.reject(t.error),C=null))}function m(){t.onAPILoad=d,t.onAuthResult=h;var n=e[0].createElement("script"),r=e[0].getElementsByTagName("script")[0];return n.type="text/javascript",n.async=!0,n.setAttribute("parsetags","explicit"),n.src="https://apis.google.com/js/client:plusone.js?onload=onAPILoad",r.parentNode.insertBefore(n,r),_=a.defer(),C=a.defer(),_.promise}function p(){E&&gapi.auth.signIn(H)}function f(){return M?a.when(M):_.promise.then(function(){return w||(w=a.defer()),w.promise},function(t){return a.reject(t)})}function v(){E&&(gapi.auth.signOut(),M=y=null,n.path("/login"))}function g(){return M&&y>new Date?a.when(M):(M=y=null,C?C.promise:a.reject("no token available, please login"))}var M=null,$=null,z=null,b=!1,y=null,E=!1,H={clientid:c,cookiepolicy:"single_host_origin",callback:"onAuthResult",scope:"https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/calendar"},_=null,C=null,w=null;return{login:p,afterLogin:f,logout:v,loadGoogleAPI:m,getToken:g,getProfile:function(){return $},getUserData:function(){return z}}}]}()},function(t){"use strict";t.exports=function(){return["$scope","$log","hsAuthService","authEvents",function(t,e,n,r){t.signed_in=!1,t.$on(r.AUTHENTICATION_CHANGE,function(e,r){t.signed_in=r,t.profile=n.getProfile(),t.profileImgSrc=t.profile?t.profile.image.url.replace(/sz=\d+/,"sz=36"):null}),t.logout=n.logout}]}()},function(t){"use strict";t.exports=function(){return["$scope","$location","$log","hsAuthService",function(t,e,n,r){function a(){var t=e.search();e.url(t.hasOwnProperty("dst")?decodeURIComponent(t.dst):"/")}function i(t){n.error("login failed: "+t),r.afterLogin().then(a,i)}r.loadGoogleAPI().then(function(){gapi.signin.render("google-login"),r.afterLogin().then(a,i)},function(){n.error("Google API not loaded")})}]}()},function(t){"use strict";t.exports=function(){return["$scope","$log","hsAuthService",function(t,e){t.getData=function(){e.log("get data")}}]}()},function(t){"use strict";t.exports=function(){return["$resource","BASE_URL",function(t,e){return t(e+"/profiles/:userId",{userId:"@userId"},{charge:{method:"POST",params:{charge:!0}}})}]}()},function(t,e,n){(function(t,n){"use strict";var r="https://www.googleapis.com/calendar/v3";e.BASE_URI=r;var a=["$http","$q","$log","hsAuthService","CALENDAR_BASE_URI",function(e,r,a,i,o){function c(){return e.get(o+"/users/me/calendarList").success(function(){}).error(function(){}).then(function(t){return t.data},function(t){return r.reject(t)})}function s(a,i,c){return e.get(o+"/calendars/"+a+"/events",{params:{timeMin:i||t().startOf("day").format(),timeMax:c||t().endOf("day").format()}}).success(function(t){n.forEach(t.items,function(e){e.calendarId=a,h[e.id]=e,e.recurringEventId&&(e.recurringEvent=t.items.find(function(t){return t.id===e.recurringEventId}),e.recurringEvent.linked=!0)}),t.items=t.items.filter(function(t){return!t.linked}),t.calendarId=a}).error(function(){}).then(function(t){return t.data},function(t){return r.reject(t)})}function l(t){return n.isUndefined(t)?null:void 0!==h[t]?h[t]:null}function d(t,n,a){return e({method:"GET",url:o+"/calendars/"+t.calendarId+"/events/"+t.id+"/instances",params:{timeMin:n.format(),timeMax:a.format(),maxResults:1}}).then(function(e){return e.data.items.length?(e.data.items[0].calendarId=t.calendarId,e.data.items[0]):r.reject("No event instances returned")})}function u(t,a,i,c,s){var l,u=t;if(n.isString(u)){if(void 0===h[u])return r.reject("Cached event with id "+u+" not found");u=h[u]}return l=r.when(u),u.recurrence&&!i&&(l=d(u,c,s)),l.then(function(t){return l=t,e({url:o+"/calendars/"+t.calendarId+"/events/"+t.id,method:"PATCH",headers:{"If-Match":t.etag},data:a}).success(function(e){n.extend(l,e),void 0!==h[t.id]&&(h[t.id]=t)}).then(function(){return l},function(t){return r.reject(t)})})}var h={};return{getCalendarList:c,getEventList:s,getEvent:l,patchEvent:u}}];e.hsCalendarService=a;var i=["$injector","CALENDAR_BASE_URI","$log","$q",function(t,e,r,a){var i;return{request:function(o){return i||(i=t.get("hsAuthService")),o.url.startsWith(e)?i.getToken().then(function(t){return n.extend(o.headers,{Authorization:"Bearer "+t}),o},function(t){return r.error("Error getting token: "+t),a.reject(t)}):o}}}];e.calendarHttpInterceptor=i,Object.defineProperty(e,"__esModule",{value:!0})}).call(e,n(10),n(14))},function(t,e,n){(function(e){"use strict";t.exports=function(){return["$scope","$location","$q","$mdDialog","ScheduleModel","hsAuthService","hsCalendarService","Util",function(t,n,r,a,i,o,c,s){function l(t){var n=c.getEvent(t.resource.recurringEventId),r=s.safeRead(n||t.resource,"extendedProperties.private.subjectId");return e.isDefined(r)&&(t.subject=f.subjects.find(function(t){return t.id===r})),t}function d(t,e){null!==h&&t.indexOf("subjectId")>=0?(s.safeSet(h,t,e),p=!0):(s.safeSet(u,t,e),m=!0)}var u={extendedProperties:{"private":{}}},h=null,m=!1,p=!1,f=o.getUserData();t.subjects=f.subjects,t.evt=l(i.getActiveEventViewState()),t.evt.recurringEventId&&(h=e.copy(u)),t.onSubjectChange=function(){d("extendedProperties.private.subjectId",t.evt.subject?t.evt.subject.id:null)},t.onSummaryChange=function(){d("summary",t.evt.summary)},t.onDescriptionChange=function(){d("description",t.evt.description)},t.toggleCompletion=i.toggleCompletion.apply(null,[t.evt]),t.ok=function(){var e=r.when(!1),a=[],o=t.evt;(m||p)&&t.evtForm.$valid&&(m&&a.push(i.patchEvent(o,u,!1)),p&&a.push(i.patchEvent(o.recurringEventId,h)),e=r.all(a)),e.then(function(){n.url("/")})},t.cancel=function(){n.url("/")}}]}()}).call(e,n(14))},function(t){"use strict";t.exports=function(){return function(t){return t.suppressEvents?t.filter(function(t){return t.isTimeAxis}):t}}},function(t,e,n){(function(e,n){"use strict";t.exports=function(){return["$scope","$log","$q","$timeout","$location","$mdDialog","ScheduleModel","Profile","Util","MathUtil","hsAuthService","hsCalendarService",function(t,r,a,i,o,c,s,l,d,u,h){function m(r){var a=1439,i=0,o=0,c=15,l=25,d=e().startOf("day"),m=t.studentEventLists.slice(0),v=m.find(function(t){return t.isTimeAxis});for(v||(v={isTimeAxis:!0,student:{}},m.unshift(v)),v.summary=s.getStart().format("dddd"),v.student.name=s.getStart().format("M/D"),n.forEach(r,function(t,e){var r=m.find(function(t){return t.student.id===e});r||m.push({student:h.getUserData().students.find(function(t){return t.id===e}),events:[]}),n.forEach(t,function(t){a=Math.min(a,t.startMinutes),i=Math.max(i,t.endMinutes)})}),a=u.floor(a,4*c),i=u.ceiling(i,4*c),t.scheduleTotalBlocks=Math.round(i-a)/c*l+"px",i>a?(p=a,f=i):(a=p,i=f),n.forEach(m,function(t){t.isTimeAxis||(t.events=[],n.forEach(r[t.student.id],function(e){e.blockOffset=Math.round(u.floor(e.startMinutes-a,c)/c)*l+"px",e.duration=u.floor(e.endMinutes-e.startMinutes,c)/c*l+"px",a=Math.min(a,e.startMinutes),i=Math.max(i,e.endMinutes),t.events.push(e)}))}),d.minutes(a),v.events=[];i>a;)v.events.push({duration:4*l+"px",blockOffset:o*l+"px",resource:{summary:d.format("ha")}}),o+=4,a+=4*c,d.add(4*c,"minutes");return m}var p=480,f=1020;this.taskMode=!0,t.login=h.login,t.animateForward=!1,t.studentEventLists=[],t.changeDay=function(e){s.changeDay(e),t.animateForward=e>0,t.changingDay=!0,i(function(){t.studentEventLists.suppressEvents=!0;var e=new Date;s.fetchStudentEvents().then(m).then(function(n){var r=(new Date).getTime()-e.getTime();i(function(){t.studentEventLists=n,t.changingDay=!1},Math.max(0,500-r),!0)})},0,!0)},t.getData=function(){s.fetchStudentEvents().then(m).then(function(e){t.studentEventLists=e},function(t){r.error(t)})},t.setActiveList=function(e){e&&e.isTimeAxis||(n.forEach(t.studentEventLists,function(t){t.active=t===e}),t.activeStudent=e)},t.openEvent=function(t){s.setActiveEvent(t),o.url("/event-detail")},t.toggleComplete=s.toggleCompletion}]}()}).call(e,n(10),n(14))},function(t,e,n){(function(e,n){"use strict";t.exports=function(){return["$q","$log","hsAuthService","hsCalendarService","Util",function(t,r,a,i,o){function c(){return m?t.when(m):i.getCalendarList().then(function(t){return m=t},function(e){return r.error(e),t.reject(e)})}function s(t){var e=o.safeRead(t,"extendedProperties.private.subjectId");return a.getUserData().subjects.find(function(t){return t.id===e})}function l(t){var n=e(t.start.dateTime),a=e(t.end.dateTime);return r.log("creating "+t.summary+" event"),{day:n.dayOfYear(),start:n,end:a,startMinutes:60*n.hours()+n.minutes(),endMinutes:60*a.hours()+a.minutes(),fmtTime:n.format("hh:mma"),subject:s(t),completion:o.safeRead(t,"extendedProperties.private.completion"),resource:t}}function d(e,n,r){return e.updating=!0,i.patchEvent(e.resource,n,r,f,v).then(function(t){return e.resource=t,e.updating=!1,e},function(n){return e.updating=!1,t.reject(n)})}function u(t){return d(t,{extendedProperties:{"private":{completion:o.safeRead(t.resource,"extendedProperties.private.completion")?null:e().format()}}},!1).then(function(e){return t.completion=o.safeRead(e.resource,"extendedProperties.private.completion"),t})}function h(){return c().then(function(e){var r=t.defer(),o={},c=0;return n.forEach(a.getUserData().students,function(a){o[a.id]=[];var s=[];n.forEach(a.calendarIDs,function(t){var n=e.items.find(function(e){return e.id===t});n&&s.push(i.getEventList(n.id,f.format(),v.format()))}),s.length&&(c++,t.all(s).then(function(t){r.notify(a.name+" data retrieved"),c--,n.forEach(t,function(t){n.forEach(t.items,function(t){o[a.id].push(l(t))})}),0===c&&r.resolve(o)},function(t){r.reject("Error fetching events for "+a.name+": "+t)}))}),r.promise})}var m=null,p=null,f=e().startOf("day"),v=e().endOf("day");return{fetchStudentEvents:h,changeDay:function(t){f.add("days",t),v.add("days",t)},setActiveEvent:function(t){p=t},patchEvent:d,toggleCompletion:u,getActiveEventViewState:function(){return p},getStart:function(){return f},getEnd:function(){return v}}}]}()}).call(e,n(10),n(14))},,,,function(t,e,n){t.exports=n.p+"components/auth/login.html"},function(t,e,n){t.exports=n.p+"components/auth/profile.html"},function(t,e,n){t.exports=n.p+"components/schedule/event-detail.html"},function(t,e,n){t.exports=n.p+"components/schedule/schedule.html"}]);